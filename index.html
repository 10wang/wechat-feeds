<!DOCTYPE html>
<html lang="zh">

<head>
  <link rel="shortcut icon"
    href="data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAAMMOAADDDgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQc7AUkHOwFAAAAAAAAAAAkHOwQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkHOwwJBzsoiQc7PkkHOz+JBzs7iQc7L0kHOzgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkHOxfJBzs/yQc7P8kHOz/JBzs/yQc7P8kHOz/JBzs/yQc7I8AAAAAAAAAAAAAAAAkHOx/JBzsMCQc7EAkHOwSJBzs/yQc7P8kHOz/JBzs/yQc7P8kHOz/JBzs/yQc7P8kHOz/JBzsPwAAAAAAAAAAJBzsbyQc7P8kHOzyJBzsZyQc7P8kHOz/JBzs/yQc7P8kHOz/JBzs/yQc7P8kHOz/JBzs/yQc7IwAAAAAJBzsQCQc7P8kHOz/JBzs/yQc7HUkHOz/JBzs/yQc7H4kHOzJJBzs/yQc7OwkHOxAJBzs/yQc7P8kHOxwJBzsECQc7P8kHOz/JBzs/yQc7P8kHOx0JBzs4iQc7P8hMO79JBzs/yQc7P8kHOz/JBzs/yQc7P8kHOzvJBzsGyQc7GgkHOz/JBzs/yQc7P8kHOz/JBzs7yQc7GUjJO3aIivt/yQc7P8kHOz/JBzs/yQc7P8kHOzZJBzsNwAAAAAkHOyBJBzs/yQc7P8kHOz/JBzs/yQc7P8kHOzvJBzsfyQc7HQkHOytJBzsvyQc7KckHOxjJBzsDwAAAAAAAAAAJBzsVCQc7P8kHOz/JBzs/yQc7NAkHOz6JBzs/yQc7P8kHOzfJBzsryQc7K8kHOy6JBzs8SQc7BUAAAAAAAAAACQc7BAkHOzPJBzs/yQc7P8kHOxhJBzs8CQc7P8kHOz/JBzsryQc7J4kHOz/JBzs/yQc7KgAAAAAAAAAAAAAAAAAAAAAJBzsMCQc7OEkHOz/Iibt/yMk7f8kHOz/JBzs/yQc7P8kHOz/JBzs/yQc7M8kHOkCAAAAAAAAAAAAAAAAAAAAAAAAAAAkHOwQJBzsjyEv7u8jJO3/JBzs/yQc7P8kHOz/JBzs/yQc7I8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkHOwQJBzsQyQc7GEkHOxhJBzsQgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8AAP/NAAD+AwAA/AEAAMAAAADAAAAAgAAAAAAAAAAAAQAAAAMAAAADAAAABwAAgAcAAMAfAADwfwAA//8AAA==" />
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title data-n-head="true">给微信公众号生成 RSS 订阅源 - wechat-feeds</title>
  <meta name="description" content="给微信公众号生成RSS订阅源" />
  <meta
    content="wechat-feeds,微信公众号RSS订阅,微信公众号RSS,微信公众号订阅,微信公众号,微信公众号文章订阅,微信公众号文章,公众号RSS订阅,公众号RSS,微信rss订阅源地址,微信rss订阅源,微信rss聚合,微信rss生成,微信公众号文章提取,公众号文章导出,微信公众号文章导出,公众号rss订阅源地址,公众号rss源,公众号rss生成器,微信公众号更新提醒"
    name="keywords" data-n-head="true">

  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.12"></script>
  <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script>

  <!-- element-ui -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/element-ui@2.13.2/lib/theme-chalk/index.css">
  <script src="https://cdn.jsdelivr.net/npm/element-ui@2.13.2/lib/index.js"></script>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-176067962-2"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'UA-176067962-2');
  </script>
</head>

<style>
  html,
  body {
    height: 100%;
  }

  #app {
    height: 100%;
    overflow-y: scroll;
  }

  .el-header {
    background-color: #B3C0D1;
    color: #333;
    line-height: 60px;
  }

  .tips {
    color: grey;
    font-size: 16px;
    text-align: center;
  }
</style>

<body>
  <el-container id="app" style="height: 100%;">
    <el-dialog title="帮助" :visible.sync="showhelp" width="90%">
      <div>
        RSS 由:
        <a href="https://github.com/hellodword/wechat-feeds" target="_blank">hellodword/wechat-feeds</a>
        提供
        <br>
        页面由:
        <a href="https://github.com/Treblex/wechat-feeds-page" target="_blank">Treblex/wechat-feeds-page</a>
        编写
        <br>
        <br>
        当前总数: {{listdata.length}}
        <br>
        <br>
        <el-switch style="display: block" v-model="github" active-color="#13ce66" inactive-color="#ff4949"
          inactive-text="国内源(gitee)" active-text="全球源(github)" @change="switchsource()">
        </el-switch>
        <br>
        <br>
        <a href="https://github.com/hellodword/wechat-feeds#%E5%A6%82%E4%BD%95%E6%B7%BB%E5%8A%A0%E4%BF%AE%E6%94%B9%E5%85%AC%E4%BC%97%E5%8F%B7"
          target="_blank"><b>没有你想要的公众号？点这里去新增</b></a>
      </div>
      <span slot="footer" class="dialog-footer">
        <el-button type="primary" @click="showhelp = false">确 定</el-button>
      </span>
    </el-dialog>


    <el-header style="display: flex;">
      <el-input placeholder="搜索(名称/描述/bizid)" v-model="key" @input="search()" clearable></el-input>
      <div style="vertical-align: middle;margin: 3px;">
        <i class="el-icon-question" @click="showhelp = true" style="vertical-align: middle;font-size: 30px;"></i>
      </div>
    </el-header>

    <el-main style="overflow-y:auto;">
      <el-backtop target=".el-main"></el-backtop>
      <ul class="infinite-list" v-loading="isloading" v-infinite-scroll="loadMore" infinite-scroll-disabled="disabled"
        infinite-scroll-immediate="false">
        <block v-for="item in showResults">
          <el-row type="flex" :gutter="8">
            <el-col style="width: 50px; right: 0px;">
              <el-avatar icon="el-icon-user-solid" size="large" shape="circle" :src="item.head_img || ''">
              </el-avatar>
            </el-col>
            <el-col>
              <div><b>{{item.name}}</b></div>
              <div
                style="overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 3;-webkit-box-orient: vertical;">
                {{item.description}}</div>
            </el-col>
            <el-col style="width: 30px; left: 0px;">
              <i @click="()=>copy(makeRssUrl(item))" class="el-icon-copy-document" style="font-size: 20px;"></i>
            </el-col>
          </el-row>

          <el-divider></el-divider>
        </block>
      </ul>
      <p class="tips" v-if="!noMore">加载中...</p>
      <p class="tips" v-if="noMore">没有更多了</p>
    </el-main>

  </el-container>


  <script>
    function getData() {
      // jsdelivr 缓存刷新没有那么及时
      return fetch("VERSION").then((res) => res.text()).then((version) => {
        return fetch(
          `https://cdn.jsdelivr.net/gh/hellodword/wechat-feeds@${version}/details.json`,
          { method: "GET" }
        )
          .then((res) => res.json())
          .then((res) => {
            return res;
          });
      });
    }

    // 防抖
    function debounce(fn, delay = 500) {
      let timer = null;
      return function (...args) {
        let that = this;
        clearTimeout(timer);
        timer = setTimeout(() => {
          fn.call(that, ...args);
        }, delay);
      };
    }


    let clipboard_;
    const vm = new Vue({
      el: "#app",
      data() {
        return {
          showhelp: true,
          loading: false,
          indexLimit: 0,
          showsearch: false,
          github: true,
          isloading: true,
          listdata: [],

          // 搜索
          key: "",
          searchResults: [],
          showResults: [],
          search: debounce(() => {
            this.showResults = [];
            document.querySelector(".el-main").scrollTop = 0;
            this.searchResults = this.selectMatchItems(this.listdata, this.key);
            this.loadMore();
          }),
        };
      },
      computed: {
        noMore() {
          return this.showResults.length >= this.searchResults.length;
        },
        disabled() {
          return this.loading || this.noMore;
        }
      },
      created() {
        clipboard_ = new ClipboardJS(".copy");
        clipboard_.on("success", this.copied);
        clipboard_.on("error", function (err) {
          throw err;
        });

        setTimeout(() => {
          getData().then((res) => {
            this.isloading = false;
            res.sort(function (a, b) {
              if (a.name < b.name) {
                return -1;
              }
              if (a.name > b.name) {
                return 1;
              }
              return 0;
            });
            this.listdata = res;
            this.searchResults = this.listdata;
            this.loadMore();
          });
        });
      },
      methods: {
        loadMore() {
          if (this.noMore) {
            return;
          }
          this.loading = true;
          this.showResults = this.showResults.concat(this.searchResults.slice(this.showResults.length, this.showResults.length + 20));
          this.loading = false;
        },
        copied() {
          this.$message({
            showClose: true,
            message: '复制成功',
            type: 'success',
          });
        },
        selectMatchItems(list, key) {
          return key == '' ? list : list.filter(item => {
            return (item['name'] || '').indexOf(key) > -1 || (item['description'] || '').indexOf(key) > -1 || (item['bizid'] && item['bizid'] === key);
          });
        },
        makeRssUrl({ bizid = "" }) {
          return this.github ? `https://github.com/hellodword/wechat-feeds/raw/feeds/${bizid}.xml` : `https://gitee.com/BlogZ/wechat-feeds/raw/feeds/${bizid}.xml`;
        },
        switchsource() {
          this.$message({
            showClose: true,
            message: this.github ? '已切换到全球源' : '已切换到国内源',
            type: 'success',
          });
        },
        copy(text) {
          let button = document.createElement("button");
          button.className = "copy";
          button.setAttribute("data-clipboard-text", text);
          document.body.appendChild(button);
          button.click();
          button.remove();
        },
      },
    });
  </script>
</body>

</html>